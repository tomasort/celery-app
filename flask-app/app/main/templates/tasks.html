{% extends "base.html" %}

{% block content %}
<style>
    progress {
        width: 300px;
        height: 30px;
    }
    button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }
</style>

<div class="container">
    <progress id="progressBar" value="0" max="100"></progress>
    <br>
    <button id="startButton">Start</button>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">
    var socket = io.connect('http://' + document.domain);

    // Update the progress bar based on the progress data received
    socket.on('progress', function(msg) {
        var progressBar = document.getElementById("progressBar");

        // Check if msg.data is a valid number
        var countdownValue = parseFloat(msg.data);

        var maxCountdown = 10; // Set this to the maximum value of your countdown
        var progressValue = ((maxCountdown - countdownValue) / maxCountdown) * 100;

        // Ensure progressValue is finite and between 0 and 100
        if (isFinite(progressValue) && progressValue >= 0 && progressValue <= 100) {
            progressBar.value = progressValue;
        } else {
            console.error("Invalid progress calculation: ", progressValue);
        }
    });

    var startButton = document.getElementById("startButton");
    startButton.addEventListener("click", async (event) => {
        try {
            const response = await fetch('/start-task', {
                method: 'GET', // GET method since we're just starting a task without sending data
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const data = await response.json();
            console.log(data.status); // Log the status or update the UI
        } catch (error) {
            console.error('Error starting the task:', error);
        }
    });
</script>

{% endblock %}
